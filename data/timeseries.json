def build_timeseries(df: pd.DataFrame) -> List[Dict[str, Any]]:
    """
    timeseries.json is a LIST of {date, count}
    Robust to multiple Kobo datetime formats, incl:
    - "10/02/2026 09:18"
    - "2026-02-10T09:18:47.762Z"
    - "2026-02-10 10:07:50.951000+01:00"
    """
    if df is None or df.empty:
        return []

    col = "_submission_time"
    if col not in df.columns:
        return []

    s = df[col].astype(str).str.strip()
    s = s.replace("nan", "").replace("None", "")
    s = s[s != ""]
    if s.empty:
        return []

    # Try parse with dayfirst (FR), then fall back to generic parsing
    ts = pd.to_datetime(s, errors="coerce", dayfirst=True, utc=True)

    # If still mostly NaT, try without utc/dayfirst (some Kobo formats differ)
    if ts.notna().sum() == 0:
        ts = pd.to_datetime(s, errors="coerce")

    tmp = pd.DataFrame({"_ts": ts}).dropna()
    if tmp.empty:
        return []

    tmp["_date"] = tmp["_ts"].dt.date.astype(str)
    g = tmp.groupby("_date").size().reset_index(name="count").sort_values("_date")
    return [{"date": str(r["_date"]), "count": int(r["count"])} for _, r in g.iterrows()]
